<?xml version="1.0" encoding="UTF-8"?>
<fmiModelDescription
    fmiVersion="2.0"
    description="A simple one dimensional trailer model.  The variable `x' is
                 the position of the trailer along the road which has local
                 elevation angle `alpha'.
                 
                 The connection to other modules is via either a torque on
                 a shaft or a driving velocity input.

There is a gear ratio from the input shaft to the wheel
rotation.  

Control can be applied via a brake.
"
    modelName="trailer"
    guid="{ca64d56e-cc83-44bb-ad78-afbe219a947c}"
    numberOfEventIndicators="0">

  <CoSimulation
      modelIdentifier="trailer"
      canHandleVariableCommunicationStepSize="true"
      canGetAndSetFMUstate="true"
      providesDirectionalDerivative="false"/>

  <LogCategories>
    <Category name="logAll"/>
    <Category name="logError"/>
    <Category name="logFmiCall"/>
    <Category name="logEvent"/>
  </LogCategories>

  <DefaultExperiment startTime="0" stopTime="10" stepSize="0.1"/>

  <ModelVariables>
    <!-- parameters and initial conditions --> 
    <!-- index="1"-->
    <ScalarVariable
        name="x0"
        valueReference="1"
        description="initial position"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="2"-->
    <ScalarVariable
        name="v0"
        valueReference="2"
        description="initial velocity"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="3"-->
    <ScalarVariable
        name="mass"
        valueReference="3"
        description="total mass of the trailer"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="4"-->
    <ScalarVariable
        name="r_w"
        valueReference="4"
        description="radius of the wheel"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
   <!-- index="5"-->
    <ScalarVariable
        name="r_g"
        valueReference="5"
        description="differential gear ratio"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="6"-->
    <ScalarVariable
        name="area"
        valueReference="6"
        description="surface area for drag resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="7"-->
    <ScalarVariable
        name="rho"
        valueReference="7"
        description="air density"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="8"-->
    <ScalarVariable
        name="c_d"
        valueReference="8"
        description="drag coefficient"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="9"-->
    <ScalarVariable
        name="g"
        valueReference="9"
        description="gravitational acceleration"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="10"-->
    <ScalarVariable
        name="c_r_0"
        valueReference="10"
        description="static rolling resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="11"-->
    <ScalarVariable
        name="c_r_1"
        valueReference="11"
        description="kinetic rolling resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="12"-->
    <ScalarVariable
        name="mu"
        valueReference="12"
        description="friction coefficient between wheel and road"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="13"-->
    <ScalarVariable
        name="k"
        valueReference="13"
        description="coupling spring constant"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="14"-->
    <ScalarVariable
        name="gamma"
        valueReference="14"
        description="damping of coupling spring"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="15"-->
    <ScalarVariable
        name="integrator"
        valueReference="15"
        description="which integrator to use"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="16"-->
    <ScalarVariable
        name="integrate_dx_e"
        valueReference="16"
        description="integrate position difference with output coupling"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
 
    <!-- index="17"-->
    <ScalarVariable
        name="integrate_d_omega"
        valueReference="17"
        description="integrate angle difference for force velocity coupling"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>      
    <!-- inputs -->
    <!-- index="18"-->
    <ScalarVariable 
        name="phi_i"
        valueReference="18"
        description="external input displacement"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="19"-->
    <ScalarVariable 
        name="omega_i"
        valueReference="19"
        description="external input velocity"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="20"-->
    <ScalarVariable 
        name="tau_d"
        valueReference="20"
        description="external driving torque"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="21"-->
    <ScalarVariable 
        name="tau_e"
        valueReference="21"
        description="extra external driving torque"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="22"-->
    <ScalarVariable 
        name="alpha"
        valueReference="22"
        description="road angle"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="23"-->
    <ScalarVariable 
        name="brake"
        valueReference="23"
        description="brake position"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- outputs -->
    <!-- index="24"-->
    <ScalarVariable 
        name="x"
        valueReference="24"
        description="position of trailer along the road"
        causality="output">
      <Real />
    </ScalarVariable>   
    <!-- index="25"-->
    <ScalarVariable 
        name="v"
        valueReference="25"
        description="velocity of trailer"
        causality="output">
      <Real />
    </ScalarVariable>
    <!-- index="26"-->
    <ScalarVariable 
        name="a"
        valueReference="26"
        description="acceleration of trailer. NOTE: this is a dummy so that
                     we can compute directional derivatives."
        causality="output">
      <Real />
    </ScalarVariable>
    <!-- index="27"-->
    <ScalarVariable 
        name="f_c"
        valueReference="27"
        description="output coupling force"
        causality="output">
      <Real />
    </ScalarVariable>
    <!-- index="28"-->
    <ScalarVariable 
        name="filter_length"
        valueReference="98"
        description="Length of EPCE FIR filter (0 = disable)"
        causality="parameter"
        variability="fixed">
      <Integer start="0"/>
    </ScalarVariable>

  </ModelVariables>

  
  <!--
      This list is 1 based according to declaration in this file. 
      Only outputs are needed, inputs are  declared implicitly from the
      connections. 

Currently used by the master only to print output values. 
  -->

  <ModelStructure>
    <Outputs>
      <Unknown index="21"/> <!-- position       -->
      <Unknown index="22"/> <!-- velocity       -->
      <Unknown index="23"/> <!-- acceleration   -->
      <Unknown index="24"/> <!-- coupling force -->
    </Outputs>
    <Derivatives/>
    <DiscreteStates/>
    <InitialUnknowns />
  </ModelStructure>

</fmiModelDescription>
