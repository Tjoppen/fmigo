<?xml version="1.0" encoding="UTF-8"?>
<fmiModelDescription
    fmiVersion="2.0"
    description="A simple one dimensional trailer model.  The variable `x' is
                 the position of the trailer along the road which has local
                 elevation angle `alpha'.
                 
                 The connection to other modules is via either a torque on
                 a shaft or a driving velocity input.

There is a gear ratio from the input shaft to the wheel
rotation.  

Control can be applied via a brake.
"
    modelName="trailer"
    guid="{ca64d56e-cc83-44bb-ad78-afbe219a947c}"
    numberOfEventIndicators="0">

  <CoSimulation
      modelIdentifier="trailer"
      canHandleVariableCommunicationStepSize="true"
      canGetAndSetFMUstate="true"
      providesDirectionalDerivative="false"/>

  <LogCategories>
    <Category name="logAll"/>
    <Category name="logError"/>
    <Category name="logFmiCall"/>
    <Category name="logEvent"/>
  </LogCategories>

  <DefaultExperiment startTime="0" stopTime="10" stepSize="0.1"/>

  <ModelVariables>
    <!-- parameters and initial conditions --> 
    <!-- index="1"-->
    <ScalarVariable
        name="x0"
        valueReference="1"
        description="initial position"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="2"-->
    <ScalarVariable
        name="v0"
        valueReference="2"
        description="initial velocity"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="3"-->
    <ScalarVariable
        name="mass"
        valueReference="3"
        description="total mass of the trailer"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="4"-->
    <ScalarVariable
        name="r_w"
        valueReference="4"
        description="radius of the wheel"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
   <!-- index="5"-->
    <ScalarVariable
        name="r_g"
        valueReference="5"
        description="differential gear ratio"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="6"-->
    <ScalarVariable
        name="area"
        valueReference="6"
        description="surface area for drag resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="7"-->
    <ScalarVariable
        name="rho"
        valueReference="7"
        description="air density"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="8"-->
    <ScalarVariable
        name="c_d"
        valueReference="8"
        description="drag coefficient"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="9"-->
    <ScalarVariable
        name="g"
        valueReference="9"
        description="gravitational acceleration"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="10"-->
    <ScalarVariable
        name="c_r_1"
        valueReference="10"
        description="static rolling resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="11"-->
    <ScalarVariable
        name="c_r_2"
        valueReference="11"
        description="kinetic rolling resistance"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="12"-->
    <ScalarVariable
        name="mu"
        valueReference="12"
        description="friction coefficient between wheel and road"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="13"-->
    <ScalarVariable
        name="k_d"
        valueReference="13"
        description="coupling spring constant on differential side"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="14"-->
    <ScalarVariable
        name="gamma_d"
        valueReference="14"
        description="damping of coupling spring on differential side"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="15"-->
    <ScalarVariable
        name="k_t"
        valueReference="15"
        description="coupling spring constant on trailer side"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="16"-->
    <ScalarVariable
        name="gamma_t"
        valueReference="16"
        description="damping of coupling spring on trailer side"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   

 
    <!-- index="17"-->
    <ScalarVariable
        name="integrate_dw"
        valueReference="17"
        description="integrate angle difference for force velocity coupling"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>      

    <!-- index="18"-->
    <ScalarVariable
        name="integrate_dx"
        valueReference="18"
        description="integrate position difference with output coupling"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   


    <!-- index="19"-->
    <ScalarVariable
        name="integrator"
        valueReference="19"
        description="which integrator to use"
        causality="parameter"
        variability="fixed">
      <Real start="0"/>
    </ScalarVariable>   


    
    <!-- inputs -->
    <!-- index="20"-->
    <ScalarVariable 
        name="phi_i"
        valueReference="20"
        description="external input displacement angle on differential"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>
    <!-- index="21"-->
    <ScalarVariable 
        name="omega_i"
        valueReference="21"
        description="external input velocity on differential"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="22"-->
    <ScalarVariable 
        name="tau_d"
        valueReference="22"
        description="external driving torque on differential"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="23"-->
    <ScalarVariable 
        name="tau_e"
        valueReference="23"
        description="extra external driving torque on differential"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   
    <!-- index="24"-->
    <ScalarVariable 
        name="angle"
        valueReference="24"
        description="road angle in radians"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="25"-->
    <ScalarVariable 
        name="brake"
        valueReference="25"
        description="brake position"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="26"-->
    <ScalarVariable 
        name="x_in"
        valueReference="26"
        description="input coupling displacement"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="27"-->
    <ScalarVariable 
        name="v_in"
        valueReference="27"
        description="input coupling speed"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   

    <!-- index="28"-->
    <ScalarVariable 
        name="f_in"
        valueReference="28"
        description="input coupling force"
        causality="input"
        initial="exact">
      <Real start="0"/>
    </ScalarVariable>   


    
    <!-- outputs -->
    <!-- index="29"-->
    <ScalarVariable 
        name="x"
        valueReference="29"
        description="position of trailer along the road"
        causality="output">
      <Real />
    </ScalarVariable>   
    <!-- index="30"-->
    <ScalarVariable 
        name="v"
        valueReference="30"
        description="velocity of trailer"
        causality="output">
      <Real />
    </ScalarVariable>
    <!-- index="31"-->
    <ScalarVariable 
        name="a"
        valueReference="31"
        description="acceleration of trailer"
        causality="output">
      <Real />
    </ScalarVariable>

    <!-- index="32"-->
    <ScalarVariable 
        name="phi"
        valueReference="32"
        description="angle of differential, computed from x"
        causality="output">
      <Real />
    </ScalarVariable>
 
    <!-- index="33"-->
    <ScalarVariable 
        name="omega"
        valueReference="33"
        description="angular speed of differential, computed from v"
        causality="output">
      <Real />
    </ScalarVariable>   

    <!-- index="34"-->
    <ScalarVariable 
        name="alpha"
        valueReference="34"
        description="angular acceleration of differential, computed from v"
        causality="output">
      <Real />
    </ScalarVariable>   
    

    <!-- index="35"-->
    <ScalarVariable 
        name="tau_c"
        valueReference="35"
        description="output coupling torque"
        causality="output">
      <Real />
    </ScalarVariable>

    <!-- index="36"-->
    <ScalarVariable 
        name="f_c"
        valueReference="36"
        description="output coupling force"
        causality="output">
      <Real />
    </ScalarVariable>

    
    <!-- index="37"-->
    <ScalarVariable 
        name="filter_length"
        valueReference="98"
        description="Length of EPCE FIR filter (0 = disable)"
        causality="parameter"
        variability="fixed">
      <Integer start="0"/>
    </ScalarVariable>

  </ModelVariables>

  
  <!--
      This list is 1 based according to declaration in this file. 
      Only outputs are needed, inputs are  declared implicitly from the
      connections. 

Currently used by the master only to print output values. 
  -->

  <ModelStructure>
    <Outputs>
      <Unknown index="29"/> <!-- position       -->
      <Unknown index="30"/> <!-- velocity       -->
      <Unknown index="31"/> <!-- acceleration   -->
      <Unknown index="32"/> <!-- angle -->
      <Unknown index="33"/> <!-- angular speed-->
      <Unknown index="34"/> <!-- angular acceleration-->
      <Unknown index="35"/> <!-- coupling torque -->
      <Unknown index="36"/> <!-- coupling force -->
    </Outputs>
    <Derivatives/>
    <DiscreteStates/>
    <InitialUnknowns />
  </ModelStructure>

</fmiModelDescription>
