<?xml version="1.0" encoding="UTF-8"?>
<fmiModelDescription
  fmiVersion="2.0"
  description="Force-velocity clutch with GSL integrator, taking torque as input"
  modelName="clutch"
  guid="{95857e9e-77b7-4d00-aef0-0836cffe26d0}"
  numberOfEventIndicators="0">

<CoSimulation
  modelIdentifier="clutch_ef"
  canHandleVariableCommunicationStepSize="true"
  canGetAndSetFMUstate="true"
  providesDirectionalDerivative="true"/>

<LogCategories>
  <Category name="logAll"/>
  <Category name="logError"/>
  <Category name="logFmiCall"/>
  <Category name="logEvent"/>
</LogCategories>

<DefaultExperiment startTime="0" stopTime="10" stepSize="0.1"/>

<ModelVariables>
  <ScalarVariable name="xi0"
                  valueReference="0"  description="initial position of in plate"                      causality="parameter" variability="fixed"><Real start="0"/></ScalarVariable>
  <ScalarVariable name="vi0"
                  valueReference="1"  description="initial velocity of in plate"                      causality="parameter" variability="fixed"><Real start="0"/></ScalarVariable>


  <ScalarVariable name="xo0"
                  valueReference="2"  description="initial position of out plate"                      causality="parameter" variability="fixed"><Real start="0"/></ScalarVariable>
  <ScalarVariable name="vo0"
                  valueReference="3"  description="initial velocity of out plate"                      causality="parameter" variability="fixed"><Real start="0"/></ScalarVariable>



    <!-- internal parameters -->
    <ScalarVariable name="mass1"
                    valueReference="4"
                    description="mass of in plate"
                    causality="parameter"
                    variability="fixed">
      <Real start="1"/>
    </ScalarVariable>

    <ScalarVariable name="gamma1"
                    valueReference="5"
                    description="damping constant for in plate"
                    causality="parameter" variability="fixed">
      <Real start="1"/>
    </ScalarVariable>

    <ScalarVariable name="mass2"
                    valueReference="6"
                    description="mass of out plate"
                    causality="parameter"
                    variability="fixed">
      <Real start="1"/>
    </ScalarVariable>

    <ScalarVariable name="gamma2"
                    valueReference="7"
                    description="damping constant for out plate"
                    causality="parameter" variability="fixed">
      <Real start="1"/>
    </ScalarVariable>

    <ScalarVariable name="clutch_damping"
                    valueReference="8"
                    description="internal clutch damping constant"
                    causality="parameter" variability="fixed">
      <Real start="100"/>
    </ScalarVariable>

    <!-- inputs -->
    <ScalarVariable name="force_in1"
                    valueReference="9"
                    description="driving torque from engine"
                    causality="input"
                    initial="exact">
      <Real start="0"/>
    </ScalarVariable>

    <ScalarVariable name="force_in2"
                    valueReference="10"
                    description="counter torque from load"
                    causality="input" initial="exact">
      <Real start="0"/>
    </ScalarVariable>

    <!-- outputs -->
    <ScalarVariable name="v1"
                    valueReference="11"
                    description="velocity of the in plate"
                    causality="output">
      <Real />
    </ScalarVariable>

    <ScalarVariable name="v2"
                    valueReference="12"
                    description="velocity of the out plate"
                    causality="output">
      <Real />
    </ScalarVariable>

    <!-- integrator. from gsl-interface.c:

        enum cgsl_integrator_ids
        {
          rk2,		/* 0 */
          rk4,		/* 1 */ 
          rkf45,	/* 2 */
          rkck,		/* 3 */
          rk8pd,	/* 4 */
          rk1imp,	/* 5 */
          rk2imp,	/* 6 */
          rk4imp,	/* 7 */
          bsimp,	/* 8 */
          msadams,	/* 9 */
          msbdf		/*10 */
        };
    -->
    <ScalarVariable name="integrator_type"   valueReference="99"  description="Integration method as per the GSL"
                    causality="parameter" variability="fixed"><Integer start="6"/></ScalarVariable>


</ModelVariables>

<ModelStructure>

  <Inputs>
    <Unknown index="10"/>
    <Unknown index="11"/>
  </Inputs>

  
  <Outputs>
    <Unknown index="12"/>
    <Unknown index="13"/>
  </Outputs>


  <Derivatives/>
  <DiscreteStates/>
  <InitialUnknowns />
</ModelStructure>

</fmiModelDescription>
