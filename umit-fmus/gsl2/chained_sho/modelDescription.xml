<?xml version="1.0" encoding="UTF-8"?>
<fmiModelDescription
  fmiVersion="2.0"
  description="Chained simple harmonic oscillator"
  modelName="chained_sho"
  guid="{a80afadc-ff4e-4990-b8de-3ef3c88baaaa}"
  numberOfEventIndicators="0">

<CoSimulation
  modelIdentifier="chained_sho"
  canHandleVariableCommunicationStepSize="true"
  canGetAndSetFMUstate="true"
  providesDirectionalDerivative="false"/>

<LogCategories>
  <Category name="logAll"/>
  <Category name="logError"/>
  <Category name="logFmiCall"/>
  <Category name="logEvent"/>
</LogCategories>

<DefaultExperiment startTime="0" stopTime="10" stepSize="0.1"/>

<ModelVariables>
    <!-- parameters for coupling -->
    <ScalarVariable name="mass"
                    valueReference="0"
                    description="mass"
                    causality="parameter"
                    variability="fixed">
        <Real start="1"/>
    </ScalarVariable>
    <ScalarVariable name="k_c"
                    valueReference="1"
                    description="coupling spring constant"
                    causality="parameter"
                    variability="fixed">
      <Real start="1"/>
    </ScalarVariable>
    <ScalarVariable name="damping_c"
                    valueReference="2"
                    description="damping constant of coupling (in physical units)"
                    causality="parameter"
                    variability="fixed">
      <Real start="1"/>
    </ScalarVariable>
    <ScalarVariable name="x0"
                    valueReference="3"
                    description="reference position for the internal spring"
                    causality="parameter"
                    variability="fixed">
      <Real start="0"/>
    </ScalarVariable>

    <!-- internal parameter -->
    <ScalarVariable name="damping_i"
                    valueReference="4"
                    description="internal damping constant in physical units"
                    causality="parameter"
                    variability="fixed">
      <Real start="1"/>
    </ScalarVariable>

    <ScalarVariable name="k_i"
                    valueReference="95"
                    description="spring constant of internal dynamics"
                    causality="parameter"
                    variability="fixed">
        <Real start="1"/>
    </ScalarVariable>

    <!-- inputs -->
    <ScalarVariable name="v_c"
                    valueReference="5"
                    description="external driving velocity"
                    causality="input" initial="exact">
      <Real start="0"/>
    </ScalarVariable>
    <ScalarVariable name="force"
                    valueReference="6"
                    description="driving force"
                    causality="input"
                    initial="exact">
      <Real start="0"/>
    </ScalarVariable>



    <!-- variables which are not reported but must be initialized -->
    <ScalarVariable name="xstart"
                    valueReference="7"
                    description="initial position"
                    causality="parameter"
                    variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <ScalarVariable name="vstart"
                    valueReference="8"
                    description="initial velocity"
                    causality="parameter" variability="fixed">
      <Real start="0"/>
    </ScalarVariable>
    <ScalarVariable name="dxstart"
                    valueReference="9"
                    description="(estimated) angle difference"
                    causality="parameter" variability="fixed">
      <Real start="0"/>
    </ScalarVariable>

    <!-- outputs -->
    <ScalarVariable name="force_c"
                    valueReference="10"
                    description="value of coupling force at last step."
                    causality="output">
      <Real />
    </ScalarVariable>
    <ScalarVariable name="x"
                    valueReference="11"
                    description="position of the internal mass"
                    causality="output">
      <Real />
    </ScalarVariable>
    <ScalarVariable name="v"
                    valueReference="12"
                    description="velocity of the internal mass"
                    causality="output">
      <Real />
    </ScalarVariable>

    <!-- Number of iterations is exposed as a Real since the master doesn't support dumping integers to CSV yet -->
    <ScalarVariable name="steps"
                    valueReference="96"
                    description="Number of internal time steps done in last communication step"
                    causality="output">
        <Real/>
    </ScalarVariable>

    <ScalarVariable name="dump_data"
                    valueReference="97"
                    description="File name for internal data (defaults to sho.m because strings aren't supported)"
                    causality="parameter"
                    variability="fixed">
        <Boolean start="false"/>
    </ScalarVariable>
    <ScalarVariable name="e_force"
                    valueReference="196"
                    description="additional driving force"
                    causality="input"
                    initial="exact">
      <Real start="0"/>
    </ScalarVariable>
</ModelVariables>

<ModelStructure>
  <Outputs>
    <Unknown index="13"/>
    <Unknown index="14"/>
    <Unknown index="15"/>
    <Unknown index="16"/>
  </Outputs>
  <Derivatives/>
  <DiscreteStates/>
  <InitialUnknowns />
</ModelStructure>

</fmiModelDescription>
