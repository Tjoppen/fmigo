<?xml version="1.0" encoding="UTF-8"?>
<!--

This FMU sends a pulse with a certain length and amplitude at a specified time
step. The output signal also has a certain DC offset. The combined purpose of
the pulse start position and DC offset is to take up any "backlash" in the
attached system. For instance, if the FMU is used together with a driveline the
user can make it run for a short time to "preload" the clutch, take up any
backlash in the gearbox etc. before the pulse itself is applied.

 out = dc_offset + pulse_amplitude     if pulse_start <= current_step < pulse_start + pulse_length
       dc_offset                       otherwise

Furthermore, pulse_type determines whether "out" is applied to the output angle
or angular velocity. In the case of angular velocity angle is also integrated.
Angle pulses have angular velocity = zero.
-->
<fmiModelDescription
  fmiVersion="2.0"
  description="Impulse source with zero mobility"
  modelName="impulse"
  guid="{bea86d20-e0df-47d3-b694-bd366a1d5731}"
  numberOfEventIndicators="0">

<CoSimulation
  modelIdentifier="impulse"
  canHandleVariableCommunicationStepSize="true"
  canGetAndSetFMUstate="true"
  providesDirectionalDerivative="true"/>

<LogCategories>
  <Category name="logAll"/>
  <Category name="logError"/>
  <Category name="logFmiCall"/>
  <Category name="logEvent"/>
</LogCategories>

<DefaultExperiment startTime="0" stopTime="10" stepSize="0.1"/>

<ModelVariables>
  <!-- Can be derived wrt force to get mobility -->
  <ScalarVariable name="theta"
                  valueReference="0"
                  description="Angle"
                  causality="output">
      <Real/>
  </ScalarVariable>

  <ScalarVariable name="omega"
                  valueReference="1"
                  description="Angular velocity"
                  causality="output">
      <Real/>
  </ScalarVariable>

  <ScalarVariable name="alpha"
                  valueReference="2"
                  description="Angular acceleration"
                  causality="output">
      <Real/>
  </ScalarVariable>

  <ScalarVariable name="tau"
                  valueReference="3"
                  description="Torque, for deriving angular mobility"
                  causality="input">
      <Real start="0"/>
  </ScalarVariable>

  <ScalarVariable name="pulse_type"
                  valueReference="4"
                  description="Type of pulse. 0 = angle pulse (omega = 0), 1 = angular velocity pulse"
                  variability="fixed"
                  causality="parameter">
      <Integer start="0"/>
  </ScalarVariable>

  <ScalarVariable name="pulse_start"
                  valueReference="5"
                  description="Time step for start of pulse"
                  variability="fixed"
                  causality="parameter">
      <Integer start="0"/>
  </ScalarVariable>

  <ScalarVariable name="pulse_length"
                  valueReference="6"
                  description="Length of pulse"
                  variability="fixed"
                  causality="parameter">
      <Integer start="1"/>
  </ScalarVariable>

  <ScalarVariable name="pulse_amplitude"
                  valueReference="7"
                  description="Amplitude of pulse"
                  variability="fixed"
                  causality="parameter">
      <Real start="1"/>
  </ScalarVariable>

  <ScalarVariable name="dc_offset"
                  valueReference="8"
                  description="DC offset of pulse"
                  variability="fixed"
                  causality="parameter">
      <Real start="0"/>
  </ScalarVariable>
</ModelVariables>

<ModelStructure>
  <Outputs>
   <Unknown index="1"/>
   <Unknown index="2"/>
   <Unknown index="3"/>
  </Outputs>
  <Derivatives/>
  <DiscreteStates/>
  <InitialUnknowns />
</ModelStructure>

</fmiModelDescription>
